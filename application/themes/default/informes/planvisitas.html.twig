{% extends "base.html.twig" %}
{% block html_head %}
<script src="{{ base_url('assets/js/autoNumeric.js')}}"></script>
<script type="text/javascript" src="{{ base_url('assets/amcharts/amcharts.js') }}"></script>
<script src="{{ base_url('assets/amcharts/serial.js') }}" type="text/javascript"></script>

<style>
    .money { text-align: right;}
</style>
<script>
    $(function() {
        {% if notif %}
        notif({{notif|json_encode}});
        {% endif %}
    
        {% if soloLectura %}
        $('input').attr('disabled', 'disabled');
        {% endif %}
    
    });
</script>
<script type="text/javascript">
    $(document).ready(function() {
        $('.money').autoNumeric('init', {
            aSep: '.',
            aDec: ',',
            mDec:0,
            wEmpty: 'zero',
            vMin: '0',
        });
    
        $(".money").each(function(index) {
            var valor = $(this).autoNumeric('get');
            $(this).val(valor);
        });
        
        $('.respuestas_relacion_visitas').change( function(e){
            var tabla = 'respuestas_relacion_visitas';
            var columna = 'col' + ($(this).attr('name')).split("_")[1];
            calcularCol( columna, tabla )       
        });

        $('.respuestas_visitas').change( function(e){
            var tabla = 'respuestas_visitas';
            var columna = 'col' + ($(this).attr('name')).split("_")[1];
            calcularCol( columna, tabla )       
        });

        $('.respuestas_actividades').change( function(e){
            var tabla = 'respuestas_actividades';
            var columna = 'col' + ($(this).attr('name')).split("_")[1];
            calcularCol( columna, tabla )       
        });

        $('form').submit(validarFormulario);

    });
 
    function asignarNumeroInput(obj, valor) {
        obj.autoNumeric('set', valor);
    }

    function obtenerNumeroInput(obj) {
        var value = obj.val();

        if(obj.hasClass('money')) {
            ///por alguna razon no llegan inicializados los inputs 
            obj.autoNumeric('init', {
                aSep: '.',
                aDec: ',',
                mDec:0,
                wEmpty: 'zero',
                vMin: '0',
            });
        }
        
        value = obj.autoNumeric('get');

        if (isNaN(value) || !value) {
            return 0;
        } else {
            return parseFloat(value);
        }            
    }

    function calcularCol( columna, tabla ) {
        var total = 0;

        $('.'+tabla+'.'+columna).each(function() {
            var obj = $(this);

            ///El unico readonly debe ser el del total
            if (!obj.is('[readonly]') && obj.val())
                total += obtenerNumeroInput(obj);
        });
        
        asignarNumeroInput($('.'+tabla+'.'+columna+'.total'), total);
    }
    
    function validarFormulario() {
        $(".money").each(function(index) {
            var valor = $(this).autoNumeric('get');
            $(this).val(valor);
        });

        $('#loadingMask').modal();
    }

    
</script>

<script type="text/javascript">


    var base = [
        'Total Visitas',
        '5.441 Productores Totales',
        '544 Productores BPA (preestablecidas)',
        '2.176 Productores CREDITO (promedio definidas)',
        '891 Productores PIÑA (grupales)',
        '100 Productores MANGO (grupales)',
        '250 Productores FRESA (grupales)',
        '600 Productores MORA (grupales)'
    ];

    var actividades = [
        'actividad1',
        'actividad2',
        'actividad3',
        'actividad4',
        'actividad5',
        'actividad6',
        'actividad7',
        'actividad8',
        'actividad9',
        'actividad10',
        'actividad11',
        'actividad12',
        'actividad13',
        'actividad14',
        'actividad15',
        'actividad16'
    ]

    var chart = null;

    AmCharts.ready(function() {
        
        chartData = getChartData();
        chart = new AmCharts.AmSerialChart();
        chart.dataProvider = chartData;
        chart.categoryField = "base";

        for (var j in actividades) {
            var valor_actividad = actividades[j];

            var graph = new AmCharts.AmGraph();
            graph.valueField = valor_actividad;
            graph.type = "column";
            graph.fillAlphas = 0.8;
            graph.title = valor_actividad;
            graph.balloonText = "[[title]] in [[category]]:<b>[[value]]</b>";
            chart.addGraph(graph);
        }

        chart.angle = 30;
        chart.depth3D = 15;
        
        var categoryAxis = chart.categoryAxis;
        categoryAxis.autoGridCount  = false;
        categoryAxis.gridCount = chartData.length;
        categoryAxis.gridPosition = "start";
        categoryAxis.labelRotation = 90;

        chart.write('chartdiv');
        
        $('#botonsito').click(refreshChart);

    });

    function getChartData() {

        var chartData = [];

        for (var i in base) {
            var valor_base = base[i];
            var obj = {
                base: valor_base
            }
            for (var j in actividades) {
                var valor_actividad = actividades[j];
                obj[valor_actividad] = Math.round(Math.random() * 100) + 1000;
            }

            chartData.push(obj);
        }

        console.log(chartData);
        return chartData;
    }

    function refreshChart() {
        chart.dataProvider = getChartData();
        chart.validateData();
    }

</script>

{% endblock %}
{% block breadcrumnb %}
<ul class="breadcrumb">
    <li><a href="{{site_url('listadoruats')}}"><i class="icon16 i-home-4"></i>Inicio</a></li>
    <li><strong class="text-success">CLASIFICACIÓN TIPO PRODUCTOR</strong></li>
</ul>
{% endblock %}
{% block titulo %} 
<h1><i class="icon20 i-stack-checkmark"></i> VTP &#187; CLASIFICACIÓN TIPO PRODUCTOR </h1>
{% endblock %}
{% block contenido %}

{{ form_open() }}
<div class="panel panel-default">
    <div class="panel-heading">
        <div class="icon"><i class="icon20 i-menu-6"></i></div>
        <h4>B.  CLASIFICACIÓN DEL PRODUCTOR SEGÚN SUS INGRESOS Y ACTIVOS</h4>
        <a href="#" class="minimize"></a>
    </div>
    <!-- End .panel-heading -->
    <div class="panel-body">
        <div class="container">
            <ul class="nav nav-pills nav-justified">
                <li class="active"><a href="#reporte1" data-toggle="tab">RELACION DE VISITAS</a></li>
                <li><a href="#reporte2" data-toggle="tab">REPORTE TOTAL DE VISITAS</a></li>
                <li><a href="#reposrte3" data-toggle="tab">REPORTE DE ACTIVIDADES</a></li>
            </ul>
            <div id='' class="tab-content">
            
                <div class="tab-pane active" id="reporte1">

                        <table class="table table-bordered animate-show-hide">
                        <thead>
                            <tr>
                                <th rowspan="2">Actividad</th>
                                <th rowspan="2">Total Visitas</th>
                                <th colspan="7" align="center">RELACION DE VISITAS QUE RECIBIRÁ CADA PRODUCTOR DE ACUERDO A LAS ACTIVIDADES DEL PROYECTO</th>
                            </tr>
                            <tr>
                                <th>5.441 Productores Totales</th>
                                <th>544 Productores BPA (preestablecidas)</th>
                                <th>2.176 Productores CREDITO (promedio definidas)</th>
                                <th>891 Productores PIÑA (grupales)</th>
                                <th>100 Productores MANGO (grupales)</th>
                                <th>250 Productores FRESA (grupales)</th>
                                <th>600 Productores MORA (grupales)</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for pa in respuestas_relacion_visitas %}
                            <tr>
                                <td style="text-align: justify;">
                                    {{pa.descripcion}}
                                </td>
                                <td>
                                    <input class="form-control col1 money respuestas_relacion_visitas" type="text" name="{{'columna_1_'~pa.id}}"  readonly/>
                                </td>
                                <td>
                                    <input class="form-control col2 money respuestas_relacion_visitas" type="text" name="{{'columna_2_'~pa.id}}"/>
                                </td>
                                <td>
                                    <input class="form-control col3 money respuestas_relacion_visitas" type="text" name="{{'columna_3_'~pa.id}}"/>
                                </td>
                                <td>
                                    <input class="form-control col4 money respuestas_relacion_visitas" type="text" name="{{'columna_4_'~pa.id}}"/>
                                </td>
                                <td>
                                    <input class="form-control col5 money respuestas_relacion_visitas" type="text" name="{{'columna_5_'~pa.id}}"/>
                                </td>
                                <td>
                                    <input class="form-control col6 money respuestas_relacion_visitas" type="text" name="{{'columna_6_'~pa.id}}"/>
                                </td>
                                <td>
                                    <input class="form-control col7 money respuestas_relacion_visitas" type="text" name="{{'columna_7_'~pa.id}}"/>
                                </td>
                                <td>
                                    <input class="form-control col8 money respuestas_relacion_visitas" type="text" name="{{'columna_8_'~pa.id}}"/>
                                </td>
                            </tr>
                            {% endfor %}
                            <tr>
                                <td style="text-align: center;">
                                    TOTALES
                                </td>
                                <td>
                                    <input class="form-control col1 money respuestas_relacion_visitas total" type="text" readonly/>
                                </td>
                                <td>
                                    <input class="form-control col2 money respuestas_relacion_visitas total" type="text" readonly/>
                                </td>
                                <td>
                                    <input class="form-control col3 money respuestas_relacion_visitas total" type="text" readonly/>
                                </td>
                                <td>
                                    <input class="form-control col4 money respuestas_relacion_visitas total" type="text" readonly/>
                                </td>
                                <td>
                                    <input class="form-control col5 money respuestas_relacion_visitas total" type="text" readonly/>
                                </td>
                                <td>
                                    <input class="form-control col6 money respuestas_relacion_visitas total" type="text" readonly/>
                                </td>
                                <td>
                                    <input class="form-control col7 money respuestas_relacion_visitas total" type="text" readonly/>
                                </td>
                                <td>
                                    <input class="form-control col8 money respuestas_relacion_visitas total" type="text" id=""/>
                                </td>
                            </tr>                            
                        </tbody>
                    </table>
                    
                    <div id="chartdiv" style="width: 1000px; height: 600px;"></div>

                </div>
                
                <div class="tab-pane" id="reporte2">

                        <table class="table table-bordered animate-show-hide">
                        <thead>
                            <tr>
                                <th rowspan="2">Actividad</th>
                                <th rowspan="2">Total Visitas</th>
                                <th colspan="7" align="center">RELACION DE VISITAS QUE RECIBIRÁ CADA PRODUCTOR DE ACUERDO A LAS ACTIVIDADES DEL PROYECTO</th>
                             </tr>
                            <tr>
                                <th >5.441 Productores Totales</th>
                                <th >544 Productores BPA (preestablecidas)</th>
                                <th >2.176 Productores CREDITO (promedio definidas)</th>
                                <th >891 Productores PIÑA (grupales)</th>
                                <th >100 Productores MANGO (grupales)</th>
                                <th >250 Productores FRESA (grupales)</th>
                                <th >600 Productores MORA (grupales)</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for pa in respuestas_visitas %}
                            <tr>
                                <td style="text-align: justify;">
                                    {{pa.descripcion}}
                                </td>
                                  <td>
                                    <input class="form-control col1 money respuestas_visitas" type="text" name="{{'columna_1_'~pa.id}}"  readonly/>
                                </td>
                                <td>
                                    <input class="form-control col2 money respuestas_visitas" type="text" name="{{'columna_2_'~pa.id}}"/>
                                </td>
                                <td>
                                    <input class="form-control col3 money respuestas_visitas" type="text" name="{{'columna_3_'~pa.id}}"/>
                                </td>
                                <td>
                                    <input class="form-control col4 money respuestas_visitas" type="text" name="{{'columna_4_'~pa.id}}"/>
                                </td>
                                <td>
                                    <input class="form-control col5 money respuestas_visitas" type="text" name="{{'columna_5_'~pa.id}}"/>
                                </td>
                                <td>
                                    <input class="form-control col6 money respuestas_visitas" type="text" name="{{'columna_6_'~pa.id}}"/>
                                </td>
                                <td>
                                    <input class="form-control col7 money respuestas_visitas" type="text" name="{{'columna_7_'~pa.id}}"/>
                                </td>
                                <td>
                                    <input class="form-control col8 money respuestas_visitas" type="text" name="{{'columna_8_'~pa.id}}"/>
                                </td>
                            </tr>
                            {% endfor %}
                            <tr>
                                <td style="text-align: center;">
                                    TOTALES
                                </td>
                                <td>
                                    <input class="form-control col1 money respuestas_visitas total" type="text" readonly/>
                                </td>
                                <td>
                                    <input class="form-control col2 money respuestas_visitas total" type="text" readonly/>
                                </td>
                                <td>
                                    <input class="form-control col3 money respuestas_visitas total" type="text" readonly/>
                                </td>
                                <td>
                                    <input class="form-control col4 money respuestas_visitas total" type="text" readonly/>
                                </td>
                                <td>
                                    <input class="form-control col5 money respuestas_visitas total" type="text" readonly/>
                                </td>
                                <td>
                                    <input class="form-control col6 money respuestas_visitas total" type="text" readonly/>
                                </td>
                                <td>
                                    <input class="form-control col7 money respuestas_visitas total" type="text" readonly/>
                                </td>
                                <td>
                                    <input class="form-control col8 money respuestas_visitas total" type="text" id=""/>
                                </td>
                            </tr>                            
                      </tbody>
                    </table>

                </div>
                
                <div class="tab-pane" id="reposrte3">

                        <table class="table table-bordered animate-show-hide">
                        <thead>
                            <tr>
                                <th rowspan="2">Actividad</th>
                                <th rowspan="2">Total Visitas</th>
                                <th colspan="7" align="center">RELACION DE VISITAS QUE RECIBIRÁ CADA PRODUCTOR DE ACUERDO A LAS ACTIVIDADES DEL PROYECTO</th>
                             </tr>
                            <tr>
                                <th>5.441 Productores Totales</th>
                                <th>544 Productores BPA (preestablecidas)</th>
                                <th>2.176 Productores CREDITO (promedio definidas)</th>
                                <th>891 Productores PIÑA (grupales)</th>
                                <th>100 Productores MANGO (grupales)</th>
                                <th>250 Productores FRESA (grupales)</th>
                                <th>600 Productores MORA (grupales)</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for pa in respuestas_actividades %}
                            <tr>
                                <td style="text-align: justify;">
                                    {{pa.descripcion}}
                                </td>
                                  <td>
                                    <input class="form-control col1 money respuestas_actividades" type="text" name="{{'columna_1_'~pa.id}}"  readonly/>
                                </td>
                                <td>
                                    <input class="form-control col2 money respuestas_actividades" type="text" name="{{'columna_2_'~pa.id}}"/>
                                </td>
                                <td>
                                    <input class="form-control col3 money respuestas_actividades" type="text" name="{{'columna_3_'~pa.id}}"/>
                                </td>
                                <td>
                                    <input class="form-control col4 money respuestas_actividades" type="text" name="{{'columna_4_'~pa.id}}"/>
                                </td>
                                <td>
                                    <input class="form-control col5 money respuestas_actividades" type="text" name="{{'columna_5_'~pa.id}}"/>
                                </td>
                                <td>
                                    <input class="form-control col6 money respuestas_actividades" type="text" name="{{'columna_6_'~pa.id}}"/>
                                </td>
                                <td>
                                    <input class="form-control col7 money respuestas_actividades" type="text" name="{{'columna_7_'~pa.id}}"/>
                                </td>
                                <td>
                                    <input class="form-control col8 money respuestas_actividades" type="text" name="{{'columna_8_'~pa.id}}"/>
                                </td>
                            </tr>
                            {% endfor %}
                            <tr>
                                <td style="text-align: center;">
                                    TOTALES
                                </td>
                                <td>
                                    <input class="form-control col1 money respuestas_actividades total" type="text" readonly/>
                                </td>
                                <td>
                                    <input class="form-control col2 money respuestas_actividades total" type="text" readonly/>
                                </td>
                                <td>
                                    <input class="form-control col3 money respuestas_actividades total" type="text" readonly/>
                                </td>
                                <td>
                                    <input class="form-control col4 money respuestas_actividades total" type="text" readonly/>
                                </td>
                                <td>
                                    <input class="form-control col5 money respuestas_actividades total" type="text" readonly/>
                                </td>
                                <td>
                                    <input class="form-control col6 money respuestas_actividades total" type="text" readonly/>
                                </td>
                                <td>
                                    <input class="form-control col7 money respuestas_actividades total" type="text" readonly/>
                                </td>
                                <td>
                                    <input class="form-control col8 money respuestas_actividades total" type="text" id=""/>
                                </td>
                            </tr>  
                        </tbody>
                    </table>

                </div>
            </div>
        </div>
    </div>
    <!-- .container and .panel-body -->
</div>
<!-- panel default -->

<br"/>

<div class="form-group">
    <div class="col-md-offset-4 col-md-5">
        {% if soloLectura %}
        <!--a href="{{site_url("listadoruats")}}" class="btn btn-lg btn-default">Volver al Listado de RUATs</a-->
        {% else %}
        <button type="submit" name=""guardar" class="btn btn-lg btn-success">Guardar</button>
        {% endif %}
    </div>
</div>
</div>
{{ form_close() }}
{% endblock %}
