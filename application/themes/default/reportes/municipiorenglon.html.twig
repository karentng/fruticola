{% extends "base.html.twig" %}

{% block html_head %}


<script type="text/javascript" src="{{ base_url('assets/amcharts/amcharts.js') }}"></script>
<script src="{{ base_url('assets/amcharts/serial.js') }}" type="text/javascript"></script>
<script src="{{ base_url('assets/amcharts/pie.js') }}" type="text/javascript"></script>

<script src="{{ base_url('assets/amcharts/exporting/amexport.js') }}" type="text/javascript"></script>
<script src="{{ base_url('assets/amcharts/exporting/rgbcolor.js') }}" type="text/javascript"></script>
<script src="{{ base_url('assets/amcharts/exporting/canvg.js') }}" type="text/javascript"></script>
<script src="{{ base_url('assets/amcharts/exporting/jspdf.js') }}" type="text/javascript"></script>
<script src="{{ base_url('assets/amcharts/exporting/filesaver.js') }}" type="text/javascript"></script>
<script src="{{ base_url('assets/amcharts/exporting/jspdf.plugin.addimage.js') }}" type="text/javascript"></script>

<script type="text/javascript">
    $('a[data-toggle="tab"]').on('shown.bs.tab', function(e) {
         chart.invalidateSize();
         chart2.invalidateSize();
    });
    var info = {{infoJSON}};
    var municipios = {{municipiosJSON}};
    var renglones = {{renglonesJSON}};

    var municipio = 0;
    var renglon = 0;
    var dataM = null;
    var dataR = null;

    dataM = generarDataMunicipio();
    dataR = generarDataRenglon();

    var exportConfig = {
        menuTop: "21px",
        menuBottom: "auto",
        menuRight: "21px",
        backgroundColor: "#efefef",
        menuItemStyle: {
            backgroundColor: '#EFEFEF',
            rollOverBackgroundColor: '#DDDDDD'},
            menuItems: [{
                textAlign: 'center',
                icon: "{{ base_url('assets/amcharts/images/export.png') }}",
                onclick: function() {
                },
                items: [{
                        title: 'JPG',
                        format: 'jpg'
                    }, {
                        title: 'PNG',
                        format: 'png'
                    }, {
                        title: 'SVG',
                        format: 'svg'
                    }, {
                        title: 'PDF',
                        format: 'pdf'
                    }]
            }]
    }

    var chart = AmCharts.makeChart("chartdiv", {
        "type": "pie",  
        "theme": "none",
        "legend": {
            "markerType": "circle",
            "position": "right",
            "marginRight": 80,      
            "autoMargins": false
        },
        "dataProvider": dataM,
        "valueField": "number",
        "outlineAlpha": 0.4,
        "depth3D": 15,
        "angle": 30,
        "titleField": "renglon",
        "balloonText": "[[title]]<br><span style='font-size:14px'><b>[[value]]</b> ([[percents]]%)</span>",
        "exportConfig": exportConfig
    });

    var chart2 = AmCharts.makeChart("chartdiv2", {
    "theme": "none",
    "type": "serial",
    "dataProvider": dataR,
    "valueAxes": [{
        "title": "Número de Fincas"
    }],
    "graphs": [{
        "balloonText": "<b>Número de fincas en [[category]] con producción de [[renglon]]: [[value]]</b>",
        "fillAlphas": 1,
        "lineAlpha": 0.2,
        "title": "Income",
        "type": "column",
        "valueField": "number"
    }],
    "depth3D": 20,
    "angle": 30,
    "rotate": true,
    "categoryField": "municipio",
    "categoryAxis": {
        "gridPosition": "start",
        "fillAlpha": 0.05,
        "position": "left"
    },
    "exportConfig":exportConfig
});

    function actualizarMunicipio(){
        municipio = $('#selectMunicipio').val();
        chart.dataProvider = generarDataMunicipio();
        chart.validateData();
    }

    function actualizarRenglon(){
        renglon = $('#selectRenglon').val();
        chart2.dataProvider = generarDataRenglon();
        chart2.validateData();
    }

    function generarDataMunicipio(){
        var data = [];
        //renglones
        for(var i = 0;i<renglones.length;i++){
            var aux = {
                'renglon': renglones[i].descripcion,
                'number': info[municipio][i]
            };
            data.push(aux);
        }
        return data;
    }

    function generarDataRenglon(){
        var data = [];
        //renglones
        for(var i = 0;i<municipios.length;i++){
            var aux = {
                'municipio': municipios[i].nombre,
                'number': info[i][renglon],
                'renglon': renglones[renglon].descripcion
            };
            data.push(aux);
        }
        return data;
    }
</script>

{% endblock %}

{% block breadcrumnb %}
    <ul class="breadcrumb">
      <li><a href="{{site_url('listadoruats')}}"><i class="icon16 i-home-4"></i>Inicio</a></li>
      <li><strong class="text-success">RUAT x MUNICIPIO x RENGLÓN</strong></li>
    </ul>
{% endblock %}

{% block titulo %}
    <h1><i class="icon20 i-stack-checkmark"></i> RUAT x MUNICIPIO x RENGLÓN  </h1> 
{% endblock %}

{% block contenido %}

{#% include "reportes/toolbar_reportes.html.twig" %#}
<div class="form-group">
    <div class="row-fluid">
        <div class="col-xs-12">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <td>
                            <b>Municipio</b>
                        </td>
                        {% for renglon in renglones %}
                            <td>
                                <b>{{renglon.descripcion}}</b>
                            </td>
                        {% endfor %}
                        <td>
                            <b>Total</b>
                        </td>
                    </tr>
                </thead>
                <tbody>
                    {% set cont = 1 %}
                    {% for municipio in municipios %}
                        <tr>
                            <td>
                                {{cont ~ ". " ~ municipio.nombre}}   
                            </td>
                            {% set cont2 = 0 %}
                            {% for renglon in renglones %}
                                <td>
                                    <center>{{info[cont-1][cont2]}}</center>
                                </td>
                                {% set cont2 = cont2 + 1 %}
                            {% endfor %}
                            <td>
                                <center><b>{{totalM[cont-1]}}</b></center>
                            </td>
                        </tr>
                        {%  set cont = cont + 1 %}
                    {% endfor %}
                    <tr>
                        <td>
                            <b>Totales</b>
                        </td>
                        {% set tm = 0 %}
                        {% for renglon in renglones %}
                            <td>
                                <center><b>{{totalR[tm]}}</b></center>
                            </td>
                            {% set tm = tm + 1 %}
                        {% endfor %}
                        <td>
                            <center><b>{{total}}</b></center>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="col-xs-12">

            <ul id="myTab" class="nav nav-tabs">
                <li class="active"><a href="#home" data-toggle="tab">RESUMEN RENGLÓN PRODUCTIVO POR MUNICIPIO</a></li>
                <li><a href="#profile" data-toggle="tab">RESUMEN POR RENGLÓN PRODUCTIVO POR MUNICIPIO</a></li>
            </ul>

            <div class="tab-content">
                <div class="tab-pane fade in active" id="home" align="center">
                    <select id="selectMunicipio" style="width:200px" onchange="actualizarMunicipio()">
                        {% set cont = 0 %}
                        {% for municipio in municipios %}
                            <option value="{{cont}}">{{municipio.nombre}}</option>
                            {% set cont = cont + 1 %}
                        {% endfor %}
                    </select>
                    <div id="chartdiv" style="width: 100%; height: 600px;"></div>
                </div>
                <div class="tab-pane fade" id="profile" align="center">
                    <select id="selectRenglon" style="width:200px" onchange="actualizarRenglon()">
                        {% set cont = 0 %}
                        {% for renglon in renglones %}
                            <option value="{{cont}}">{{renglon.descripcion}}</option>
                            {% set cont = cont + 1 %}
                        {% endfor %}
                    </select>
                    <div id="chartdiv2" style="width: 100%; height: 1000px;"></div>
                </div>
            </div>





            <!--<div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
                            RESUMENES
                        </a>
                    </h4>
                </div>
                <div id="collapseOne" class="panel-collapse collapse in">
                    <div class="panel-body" align="center">
                        <b>RESUMEN RENGLÓN PRODUCTIVO POR MUNICIPIO</b><br/>
                        

                        <b>RESUMEN POR RENGLÓN PRODUCTIVO POR MUNICIPIO</b><br/>
                        
                    </div>
                </div>
            </div>-->
        </div>
    </div>
</div>
{% endblock %}